"use strict";(self.webpackChunkmy_website=self.webpackChunkmy_website||[]).push([[4046],{6102:(e,n,t)=>{t.r(n),t.d(n,{assets:()=>o,contentTitle:()=>c,default:()=>h,frontMatter:()=>r,metadata:()=>a,toc:()=>l});var i=t(4848),s=t(8453);const r={},c="Fixing missing AOBs",a={id:"guides/fixing-compatibility-problems",title:"Fixing missing AOBs",description:"If UE4SS won't properly start because of missing AOBs, you can provide your own AOB and callback using Lua.",source:"@site/versioned_docs/version-3.0.1/guides/fixing-compatibility-problems.md",sourceDirName:"guides",slug:"/guides/fixing-compatibility-problems",permalink:"/RE-UE4SS/guides/fixing-compatibility-problems",draft:!1,unlisted:!1,editUrl:"https://github.com/UE4SS-RE/RE-UE4SS/edit/main/docs/guides/fixing-compatibility-problems.md",tags:[],version:"3.0.1",frontMatter:{},sidebar:"docs",previous:{title:"Creating GUI tabs with a C++ mod",permalink:"/RE-UE4SS/guides/creating-gui-tabs-with-c++-mod"},next:{title:"Generating UHT compatible headers",permalink:"/RE-UE4SS/guides/generating-uht-compatible-headers"}},o={},l=[{value:"How to find AOBs",id:"how-to-find-aobs",level:2},{value:"How to setup your own AOB and callback",id:"how-to-setup-your-own-aob-and-callback",level:2},{value:"What &#39;OnMatchFound&#39; must return for each AOB",id:"what-onmatchfound-must-return-for-each-aob",level:2},{value:"Example script (Simple, direct scan)",id:"example-script-simple-direct-scan",level:2},{value:"Example script (Advanced, indirect scan)",id:"example-script-advanced-indirect-scan",level:2}];function d(e){const n={a:"a",br:"br",code:"code",h1:"h1",h2:"h2",li:"li",ol:"ol",p:"p",pre:"pre",ul:"ul",...(0,s.R)(),...e.components};return(0,i.jsxs)(i.Fragment,{children:[(0,i.jsx)(n.h1,{id:"fixing-missing-aobs",children:"Fixing missing AOBs"}),"\n",(0,i.jsx)(n.p,{children:"If UE4SS won't properly start because of missing AOBs, you can provide your own AOB and callback using Lua."}),"\n",(0,i.jsxs)(n.p,{children:["For this guide you'll need to know what a ",(0,i.jsx)(n.code,{children:"root directory"})," and ",(0,i.jsx)(n.code,{children:"working directory"})," is.\r\nA ",(0,i.jsx)(n.code,{children:"root directory"})," is always the directory that contains ",(0,i.jsx)(n.code,{children:"ue4ss.dll"}),".\r\nA ",(0,i.jsx)(n.code,{children:"working directory"})," is either the directory that contains ",(0,i.jsx)(n.code,{children:"ue4ss.dll"})," OR a game specific directory, for example ",(0,i.jsx)(n.code,{children:"<root directory>/SatisfactoryEarlyAccess"}),"."]}),"\n",(0,i.jsx)(n.h2,{id:"how-to-find-aobs",children:"How to find AOBs"}),"\n",(0,i.jsx)(n.p,{children:"Since the process is quite complicated, here will just cover the general steps you need to take."}),"\n",(0,i.jsxs)(n.ol,{children:["\n",(0,i.jsx)(n.li,{children:"Make a blank shipped game in your game's UE version, with PDBs"}),"\n",(0,i.jsx)(n.li,{children:"Read game's memory using x64dbg"}),"\n",(0,i.jsxs)(n.li,{children:["Look for the signature you need - those can be found ",(0,i.jsx)(n.a,{href:"#what-onmatchfound-must-return-for-each-aob",children:"below"})]}),"\n",(0,i.jsx)(n.li,{children:"Grab a copy of the bytes from that function, sometimes the header is enough. If it is not, it may be better to grab a call to the function and if it's not a virtual function, you can grab the RIP address there"}),"\n",(0,i.jsx)(n.li,{children:"Open your game's memory in x64dbg and search it for the same block of bytes"}),"\n",(0,i.jsxs)(n.li,{children:["If you find it, you can use the ",(0,i.jsx)(n.a,{href:"https://github.com/Nukem9/SwissArmyKnife",children:"swiss army knife"})," tool to extract the AOB for it which you can use in a simple script such as example ",(0,i.jsx)(n.a,{href:"#example-script-simple-direct-scan",children:"here"})]}),"\n"]}),"\n",(0,i.jsx)(n.h2,{id:"how-to-setup-your-own-aob-and-callback",children:"How to setup your own AOB and callback"}),"\n",(0,i.jsxs)(n.ol,{children:["\n",(0,i.jsxs)(n.li,{children:["Create the directory ",(0,i.jsx)(n.code,{children:"UE4SS_Signatures"})," if it doesn't already exist in your ",(0,i.jsx)(n.code,{children:"working directory"}),"."]}),"\n",(0,i.jsx)(n.li,{children:"Identify which AOBs are broken and needs fixing."}),"\n",(0,i.jsxs)(n.li,{children:["Make the following files inside ",(0,i.jsx)(n.code,{children:"UE4SS_Signatures"}),", depending on which AOBs are broken:","\n",(0,i.jsxs)(n.ul,{children:["\n",(0,i.jsx)(n.li,{children:"GUObjectArray.lua"}),"\n",(0,i.jsx)(n.li,{children:"FName_ToString.lua"}),"\n",(0,i.jsx)(n.li,{children:"FName_Constructor.lua"}),"\n",(0,i.jsx)(n.li,{children:"FText_Constructor.lua"}),"\n",(0,i.jsx)(n.li,{children:"StaticConstructObject.lua"}),"\n",(0,i.jsx)(n.li,{children:"GMalloc.lua"}),"\n"]}),"\n"]}),"\n",(0,i.jsxs)(n.li,{children:["Inside the ",(0,i.jsx)(n.code,{children:".lua"})," file you need a global ",(0,i.jsx)(n.code,{children:"Register"})," function with no params","\n",(0,i.jsxs)(n.ul,{children:["\n",(0,i.jsxs)(n.li,{children:["Keep in mind that the names of functions in Lua files in the ",(0,i.jsx)(n.code,{children:"UE4SS_Signatures"})," directory are case-senstive."]}),"\n"]}),"\n"]}),"\n",(0,i.jsxs)(n.li,{children:["The ",(0,i.jsx)(n.code,{children:"Register"})," function must return the AOB that you want UE4SS to scan for.","\n",(0,i.jsxs)(n.ul,{children:["\n",(0,i.jsx)(n.li,{children:"The format is a list of nibbles, and every two forms a byte."}),"\n",(0,i.jsx)(n.li,{children:"I like putting a space between each byte just for clarity but this is not a requirement."}),"\n",(0,i.jsxs)(n.li,{children:["An example of an AOB: ",(0,i.jsx)(n.code,{children:"8B 51 04 85"}),"."]}),"\n",(0,i.jsxs)(n.li,{children:["Another example of an AOB: ",(0,i.jsx)(n.code,{children:"8B510485"}),"."]}),"\n",(0,i.jsx)(n.li,{children:"The AOB scanner supports wildcards for either nibble or the entire byte."}),"\n"]}),"\n"]}),"\n",(0,i.jsxs)(n.li,{children:["Next you need to create a global ",(0,i.jsx)(n.code,{children:"OnMatchFound"})," function.","\n",(0,i.jsxs)(n.ul,{children:["\n",(0,i.jsxs)(n.li,{children:["This function has one param, ",(0,i.jsx)(n.code,{children:"MatchAddress"}),", and this is the address of the match."]}),"\n",(0,i.jsx)(n.li,{children:"It's in this function that you'll place all your logic for calculating the final address."}),"\n",(0,i.jsxs)(n.li,{children:["The most simple way to do this is to make sure that your AOB leads directly to the start of the final address. That way you can simply return ",(0,i.jsx)(n.code,{children:"MatchAddress"}),"."]}),"\n",(0,i.jsxs)(n.li,{children:["In the event that you're doing something more advanced (e.g. indirect aob scan), UE4SS makes available two global functions, ",(0,i.jsx)(n.code,{children:"DerefToInt32"})," which takes an address and returns, as a 32-bit integer, whatever data is located there OR ",(0,i.jsx)(n.code,{children:"nil"})," if the address could not be dereferenced, and ",(0,i.jsx)(n.code,{children:"print"})," for debugging purposes."]}),"\n"]}),"\n"]}),"\n"]}),"\n",(0,i.jsx)(n.h2,{id:"what-onmatchfound-must-return-for-each-aob",children:"What 'OnMatchFound' must return for each AOB"}),"\n",(0,i.jsxs)(n.ul,{children:["\n",(0,i.jsxs)(n.li,{children:["GUObjectArray","\n",(0,i.jsxs)(n.ul,{children:["\n",(0,i.jsx)(n.li,{children:"Must return the exact address of the global variable named 'GUObjectArray'."}),"\n"]}),"\n"]}),"\n",(0,i.jsxs)(n.li,{children:["FName_ToString","\n",(0,i.jsxs)(n.ul,{children:["\n",(0,i.jsxs)(n.li,{children:["Must return the exact address of the start of the function 'FName::ToString'.",(0,i.jsx)(n.br,{}),"\n","Function signature: ",(0,i.jsx)(n.code,{children:"public: void cdecl FName::ToString(class FString & ptr64)const __ptr64"})]}),"\n"]}),"\n"]}),"\n",(0,i.jsxs)(n.li,{children:["FName_Constructor","\n",(0,i.jsxs)(n.ul,{children:["\n",(0,i.jsxs)(n.li,{children:["Must return the exact address of the start of the function 'FName::FName'.",(0,i.jsx)(n.br,{}),"\n","This callback is likely to be called many times and we do a check behind the scenes to confirm if we found the right constructor.",(0,i.jsx)(n.br,{}),"\n","It doesn't matter if your AOB finds both 'char*' versions and 'wchar_t*' versions.",(0,i.jsx)(n.br,{}),"\n","Function signature: ",(0,i.jsx)(n.code,{children:"public: cdecl FName::FName(wchar_t const * ptr64,enum EFindName) __ptr64"})]}),"\n"]}),"\n"]}),"\n",(0,i.jsxs)(n.li,{children:["FText_Constructor","\n",(0,i.jsxs)(n.ul,{children:["\n",(0,i.jsxs)(n.li,{children:["Must return the exact address of the start of the function 'FText::FText'.",(0,i.jsx)(n.br,{}),"\n","Function signature: ",(0,i.jsx)(n.code,{children:"public: cdecl FText::FText(class FString & ptr64)const __ptr64"})]}),"\n"]}),"\n"]}),"\n",(0,i.jsxs)(n.li,{children:["StaticConstructObject","\n",(0,i.jsxs)(n.ul,{children:["\n",(0,i.jsxs)(n.li,{children:["Must return the exact address of the start of the global function 'StaticConstructObject_Internal'.",(0,i.jsx)(n.br,{}),"\n","In UE4SS, we scan for a call in the middle of 'UUserWidget::InitializeInputComponent' and then resolve the call location.",(0,i.jsx)(n.br,{}),"\n","Function signature: ",(0,i.jsx)(n.code,{children:"class UObject * __ptr64 __cdecl StaticConstructObject_Internal(struct FStaticConstructObjectParameters const & __ptr64)"})]}),"\n"]}),"\n"]}),"\n",(0,i.jsxs)(n.li,{children:["GMalloc","\n",(0,i.jsxs)(n.ul,{children:["\n",(0,i.jsxs)(n.li,{children:["Must return the exact address of the global variable named 'GMalloc'.",(0,i.jsx)(n.br,{}),"\n","In UE4SS, we scan for 'FMemory::Free' and then resolve the MOV instruction closest to the first CALL instruction."]}),"\n"]}),"\n"]}),"\n"]}),"\n",(0,i.jsx)(n.h2,{id:"example-script-simple-direct-scan",children:"Example script (Simple, direct scan)"}),"\n",(0,i.jsx)(n.pre,{children:(0,i.jsx)(n.code,{className:"language-lua",children:'function Register()\r\n    return "48 8B C4 57 48 83 EC 70 80 3D ?? ?? ?? ?? ?? 48 89"\r\nend\r\n\r\nfunction OnMatchFound(MatchAddress)\r\n    return MatchAddress\r\nend\n'})}),"\n",(0,i.jsx)(n.h2,{id:"example-script-advanced-indirect-scan",children:"Example script (Advanced, indirect scan)"}),"\n",(0,i.jsx)(n.pre,{children:(0,i.jsx)(n.code,{className:"language-lua",children:'function Register()\r\n    return "41 B8 01 00 00 00 48 8D 15 ?? ?? ?? ?? 48 8D 0D ?? ?? ?? ?? E9"\r\nend\r\n\r\nfunction OnMatchFound(MatchAddress)\r\n    local InstrSize = 0x05\r\n\r\n    local JmpInstr = MatchAddress + 0x14\r\n    local Offset = DerefToInt32(JmpInstr + 0x1)\r\n    local Destination = JmpInstr + Offset + InstrSize\r\n\r\n    return Destination\r\nend\n'})})]})}function h(e={}){const{wrapper:n}={...(0,s.R)(),...e.components};return n?(0,i.jsx)(n,{...e,children:(0,i.jsx)(d,{...e})}):d(e)}},8453:(e,n,t)=>{t.d(n,{R:()=>c,x:()=>a});var i=t(6540);const s={},r=i.createContext(s);function c(e){const n=i.useContext(r);return i.useMemo((function(){return"function"==typeof e?e(n):{...n,...e}}),[n,e])}function a(e){let n;return n=e.disableParentContext?"function"==typeof e.components?e.components(s):e.components||s:c(e.components),i.createElement(r.Provider,{value:n},e.children)}}}]);